# Apache Configuration for GC Resume Filter
# This configures path-based routing at /resumefilter/ to work alongside other sites

# Add this configuration to your main Apache config or include it in your existing VirtualHost

# Backend API Proxy - Must come BEFORE the Alias directive
# Strip /resumefilter prefix and pass to backend with /api
ProxyPass /resumefilter/api http://127.0.0.1:8000/api
ProxyPassReverse /resumefilter/api http://127.0.0.1:8000/api

# WebSocket support for API (if needed in future)
RewriteEngine on
RewriteCond %{HTTP:Upgrade} websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^/resumefilter/api/?(.*) "ws://127.0.0.1:8000/api/$1" [P,L]

# Frontend - Serve React build from /var/www/html/resumefilter
Alias /resumefilter "__PROJECT_ROOT__/frontend/dist"

<Directory "__PROJECT_ROOT__/frontend/dist">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Handle React Router - redirect all requests to index.html
    # This ensures /resumefilter/some-route still loads the React app
    RewriteEngine On
    RewriteBase /resumefilter/
    RewriteRule ^index\.html$ - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /resumefilter/index.html [L]
</Directory>

# Security headers for this path
<Location /resumefilter>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
</Location>
